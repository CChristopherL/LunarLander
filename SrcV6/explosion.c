#include "explosion.h"
#include "background.h"

void initExplosion(explosion_t *explosion, vector_t position) {
	static const uint16_t explosionImage[5][24] = {
		{0x0020,0x0020,0x99DC,0x0020,0x0020,0x0020,
		0x39DF,0x39DF,0x0020,0x99DC,0x39DF,0x0020,
		0x0020,0x39DC,0x99DF,0x39DC,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020},

		{0x08DF,0x08B1,0x08DF,0x08DC,0x0020,0x08B1,
		0x08DC,0x0020,0x0BB1,0x0BDC,0x0020,0x08DC,
		0x08DC,0x08DC,0x0020,0x08DC,0x08B1,0x0020,
		0x08DF,0x0020,0x0020,0x0020,0x0020,0x0020},

		{0x08DC,0x0020,0x99B1,0x0020,0x0020,0x0020,
		0x08B1,0x99B1,0x0020,0x0020,0x08DC,0x0020,
		0x08DC,0x0020,0x0020,0x08B1,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020},

		{0x0020,0x0020,0xB8DF,0x0020,0xB8DF,0x0020,
		0xB8DF,0x0020,0x0020,0xB8DF,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020,
		0xB8DF,0x0020,0x0020,0x0020,0xB8DF,0x0020},

		{0x0020,0x0020,0x0020,0x0020,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020,
		0x0020,0x0020,0x0020,0x0020,0x0020,0x0020}
	};

	static const vector_t explosionSize = {6, 4};

	explosion->image = explosionImage;
	explosion->size = explosionSize;

	explosion->position = position;
	explosion->frame = (4 << 4);
}

void updateExplosion(explosion_t *explosion, uint32_t deltaTime) {
	if ((explosion->frame >> 4) > 3) {
		return;
	}

	// Update frame
	explosion->frame += deltaTime;

	vector_t displayPosition = {(explosion->position.x >> 10), (explosion->position.y >> 10)};
	addToBuffer(explosion->image[explosion->frame >> 4], displayPosition, explosion->size);
}
